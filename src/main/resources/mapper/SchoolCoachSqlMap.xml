<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.great.dao.SchoolCoachDao">


     <resultMap id="Coach" type="com.great.entity.Coach">
            <result column="coach_state_id" property="coach_state_id"></result>
     </resultMap>
    <!--查询教练记录并分页    -->
    <select id="findCoachByPage" resultMap="Coach" parameterType="com.great.entity.TableUtils">
        select * from coach
        <where>
            <if test="name !='' and name!=null">
                and name like concat('%',#{name},'%')
            </if>
            <if test="phone !='' and phone!=null">
                and phone = #{phone}
            </if>
            <if test="state !='' and state!=null">
                and coach_state_id = #{state}
            </if>
            <if test="idnumber!= '' and idnumber != null">
                and idnumber= #{idnumber}
            </if>
            <if test="sex != '' and sex != null">
                and sex = #{sex}
            </if>
        </where>
        limit #{minLimit},#{maxLimit}
    </select>

    <!--查询驾校管理员信息总数-->
    <select id="findCoachCount" resultType="java.lang.Integer" parameterType="com.great.entity.TableUtils">
        select count(*) from coach
        <where>
            <if test="name !='' and name!=null">
                and name like concat('%',#{name},'%')
            </if>
            <if test="phone !='' and phone!=null">
                and phone = #{phone}
            </if>
            <if test="state !='' and state!=null">
                and coach_state_id = #{state}
            </if>
            <if test="idnumber!= '' and idnumber != null">
                and idnumber= #{idnumber}
            </if>
            <if test="sex != '' and sex != null">
                and sex = #{sex}
            </if>
        </where>

    </select>

    <!--删除教练-->
    <delete id="deleteCount"  parameterType="java.lang.Integer">
        delete  from coach where id =#{id}
    </delete>

    <!--更新教练信息-->
    <update id="updateCoach" parameterType="com.great.entity.Coach" >
        update coach  set name = #{name},phone =#{phone}  where id =#{id}
    </update>

    <!--查看账号是否被使用-->
    <select id="CheckCoachAccount" parameterType = "String" resultType="java.lang.Integer">
        select count(id) FROM coach where account= #{account}
    </select>


    <!--添加驾校管理员-->
    <insert id="addCoach"   parameterType="com.great.entity.Coach">
		insert into coach (account,pwd,name,sex,age,idnumber,phone,coach_state_id,school_id,image)
		VALUES(#{account},#{pwd},#{name},#{sex},#{age},#{idnumber},#{phone},#{coach_state_id},#{school_id},#{image})
	</insert>


    <!--查找教练所有信息-->
    <select id="findAllCoach" resultType="Coach" parameterType = "java.lang.Integer" >
		select * from coach where school_id = #{school_id}
	</select>

    <!--修改教练密码-->
    <update id="changeCoachpwd"  parameterType="com.great.entity.Coach">
		update coach set pwd = #{pwd} where id = #{id}
	</update>

    <!--登录-->
    <select id="login" resultType="com.great.entity.Coach" parameterType="java.util.Map">
		select * from coach where account = #{account} and pwd = #{pwd}
	</select>


    <!--单独插入图片-->
    <update id="AddCoachImage"   parameterType="java.util.Map">
		 update coach  set image = #{image} where id =#{id}
	</update>

    <!--修改状态-->
    <update id="ChangeCoachState"   parameterType="java.util.Map">
		 update coach  set coach_state_id = #{coach_state_id} where id =#{id}
	</update>

































    <!--添加用户-->
	<insert id="addUser"   parameterType="com.great.entity.User">
		insert into user (account,pwd,name,sex,education,profession,phone,email,rtime,state,roleid,score,upcount,downcount)
		VALUES(#{account},#{pwd},#{name},#{sex},#{education},#{profession},#{phone},#{email},#{rtime},#{state},#{roleid},#{score},#{upcount},#{downcount})

	</insert>
    <!--查找角色信息并带条件的分页-->
    <select id="findAllUserByPage" resultType="User" parameterType="java.util.Map" >
		select * from  user where 1=1
        <if test="rtime1 != '' and rtime1 != null">
            and rtime &gt;= #{rtime1}
        </if>
        <if test="rtime2 != '' and rtime2 != null">
            and rtime &lt;= #{rtime2}
        </if>
        <if test="userid != '' and userid != null">
            and userid like concat ('%',#{userid},'%')
        </if>
        limit #{minLimit},#{maxLimit}
	</select>
    <!--查找用户信息总数-->
    <select id="findAllUserCount" resultType="java.lang.Integer" parameterType="java.util.Map">
		select count(*) from user
		<where>
            <if test="userid !='' and userid!=null">
                and userid like#{userid}
            </if>
        </where>

	</select>

    <!--更新用户信息-->
    <update id="updateUserInf" parameterType="com.great.entity.User" >
        update user  set name = #{name},sex = #{sex},education = #{education},profession=#{profession},
        phone =#{phone} , email = #{email},state = #{state} where userid =#{userid}
    </update>
    <!--更新用户状态-->
    <update id="changeUserState" parameterType="java.util.Map" >
        update user  set state = #{state} where userid =#{userid}

    </update>
    <select id="cUser" parameterType = "String" resultType="java.lang.Integer">
        select count(userid) FROM user where account= #{account}
    </select>



</mapper>